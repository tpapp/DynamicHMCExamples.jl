<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Linear regression · DynamicHMCExamples.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DynamicHMCExamples.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../example_independent_bernoulli/">Estimate Bernoulli draws probabilility</a></li><li class="is-active"><a class="tocitem" href>Linear regression</a></li><li><a class="tocitem" href="../example_logistic_regression/">Logistic regression</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Linear regression</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Linear regression</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/tpapp/DynamicHMCExamples.jl/blob/master/src/example_linear_regression.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Linear-regression"><a class="docs-heading-anchor" href="#Linear-regression">Linear regression</a><a id="Linear-regression-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-regression" title="Permalink"></a></h1><p>We estimate simple linear regression model with a half-T prior. First, we load the packages we use.</p><p>First, we import DynamicHMC and related libraries,</p><pre><code class="language-julia hljs">using TransformVariables, LogDensityProblems, LogDensityProblemsAD,
    DynamicHMC, TransformedLogDensities</code></pre><p>then some packages that help code the log posterior,</p><pre><code class="language-julia hljs">using Parameters, Statistics, Random, Distributions, LinearAlgebra</code></pre><p>then diagnostic and benchmark tools,</p><pre><code class="language-julia hljs">using MCMCDiagnosticTools, DynamicHMC.Diagnostics, BenchmarkTools</code></pre><p>and use ForwardDiff for AD since the dimensions is small.</p><pre><code class="language-julia hljs">import ForwardDiff</code></pre><p>Then define a structure to hold the data: observables, covariates, and the degrees of freedom for the prior.</p><pre><code class="language-julia hljs">&quot;&quot;&quot;
Linear regression model ``y ∼ Xβ + ϵ``, where ``ϵ ∼ N(0, σ²)`` IID.

Weakly informative prior for `β`, half-T for `σ`.
&quot;&quot;&quot;
struct LinearRegressionProblem{TY &lt;: AbstractVector, TX &lt;: AbstractMatrix,
                               Tν &lt;: Real}
    &quot;Observations.&quot;
    y::TY
    &quot;Covariates&quot;
    X::TX
    &quot;Degrees of freedom for prior.&quot;
    ν::Tν
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.LinearRegressionProblem</code></pre><p>Then make the type callable with the parameters <em>as a single argument</em>.</p><pre><code class="language-julia hljs">function (problem::LinearRegressionProblem)(θ)
    @unpack y, X, ν = problem   # extract the data
    @unpack β, σ = θ            # works on the named tuple too
    ϵ_distribution = Normal(0, σ) # the error term
    ℓ_error = mapreduce((y, x) -&gt; logpdf(ϵ_distribution, y - dot(x, β)), +,
                        y, eachrow(X))    # likelihood for error
    ℓ_σ = logpdf(TDist(ν), σ)             # prior for σ
    ℓ_β = loglikelihood(Normal(0, 10), β) # prior for β
    ℓ_error + ℓ_σ + ℓ_β
end</code></pre><p>Make up random data and test the function runs.</p><pre><code class="language-julia hljs">N = 100
X = hcat(ones(N), randn(N, 2));
β = [1.0, 2.0, -1.0]
σ = 0.5
y = X*β .+ randn(N) .* σ;
p = LinearRegressionProblem(y, X, 1.0);
p((β = β, σ = σ))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-85.22962065233153</code></pre><p>It is usually a good idea to benchmark and optimize your log posterior code at this stage. Above, we have carefully optimized allocations away using <code>mapreduce</code>.</p><pre><code class="language-julia hljs">@btime p((β = $β, σ = $σ))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-85.22962065233153</code></pre><p>For this problem, we write a function to return the transformation (as it varies with the number of covariates).</p><pre><code class="language-julia hljs">function problem_transformation(p::LinearRegressionProblem)
    as((β = as(Array, size(p.X, 2)), σ = asℝ₊))
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">problem_transformation (generic function with 1 method)</code></pre><p>Wrap the problem with a transformation, then use ForwardDiff for the gradient.</p><pre><code class="language-julia hljs">t = problem_transformation(p)
P = TransformedLogDensity(t, p)
∇P = ADgradient(:ForwardDiff, P);</code></pre><p>Finally, we sample from the posterior. <code>chain</code> holds the chain (positions and diagnostic information), while the second returned value is the tuned sampler which would allow continuation of sampling.</p><pre><code class="language-julia hljs">results = map(_ -&gt; mcmc_with_warmup(Random.default_rng(), ∇P, 1000), 1:5)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{NamedTuple{(:posterior_matrix, :tree_statistics, :κ, :ϵ), Tuple{Matrix{Float64}, Vector{DynamicHMC.TreeStatisticsNUTS}, DynamicHMC.GaussianKineticEnergy{LinearAlgebra.Diagonal{Float64, Vector{Float64}}, LinearAlgebra.Diagonal{Float64, Vector{Float64}}}, Float64}}}:
 (posterior_matrix = [0.9747610524407802 1.0017220727115828 … 1.0503989480312017 1.0862616277254271; 2.009693279515295 1.990665570913579 … 1.972315269049868 2.1106231976807153; -1.0345730733175917 -1.1053640979702257 … -0.9963895266739211 -0.9390834849443291; -0.6406652329492621 -0.7198444358680679 … -0.7449273257346374 -0.6873375733795531], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-92.11179652501004, 2, turning at positions 0:3, 0.8828905288187575, 3, DynamicHMC.Directions(0x50c16a7f)), DynamicHMC.TreeStatisticsNUTS(-88.82965082208115, 2, turning at positions -2:1, 0.848327496742476, 3, DynamicHMC.Directions(0xcedd1629)), DynamicHMC.TreeStatisticsNUTS(-89.9670335356581, 2, turning at positions -2:1, 0.8717700034787147, 3, DynamicHMC.Directions(0x2bfa7535)), DynamicHMC.TreeStatisticsNUTS(-88.02701280968677, 3, turning at positions -3:4, 0.9971989596817453, 7, DynamicHMC.Directions(0xff74ae1c)), DynamicHMC.TreeStatisticsNUTS(-86.97601855724632, 2, turning at positions 0:3, 0.9999999999999999, 3, DynamicHMC.Directions(0xbd64e50f)), DynamicHMC.TreeStatisticsNUTS(-86.35730908988091, 2, turning at positions -1:2, 0.9445766531086425, 3, DynamicHMC.Directions(0xdf8208e6)), DynamicHMC.TreeStatisticsNUTS(-87.11815245981546, 3, turning at positions -4:3, 0.8874992232444662, 7, DynamicHMC.Directions(0x3369869b)), DynamicHMC.TreeStatisticsNUTS(-90.04114554353966, 3, turning at positions -4:3, 0.6941134954358628, 7, DynamicHMC.Directions(0x05fb91e3)), DynamicHMC.TreeStatisticsNUTS(-87.78058277977361, 2, turning at positions -1:2, 0.9999999999999999, 3, DynamicHMC.Directions(0x4eddfb42)), DynamicHMC.TreeStatisticsNUTS(-86.06052996907619, 2, turning at positions -3:0, 0.9999999999999999, 3, DynamicHMC.Directions(0x4de778b4))  …  DynamicHMC.TreeStatisticsNUTS(-89.29416208110233, 2, turning at positions -1:2, 0.9696855699608257, 3, DynamicHMC.Directions(0x8882e5f6)), DynamicHMC.TreeStatisticsNUTS(-88.51343585144498, 2, turning at positions -4:-7, 0.9168084983033005, 7, DynamicHMC.Directions(0x01e9c7c8)), DynamicHMC.TreeStatisticsNUTS(-91.32532614385624, 3, turning at positions -2:5, 0.9189836623376447, 7, DynamicHMC.Directions(0x3f0bc3bd)), DynamicHMC.TreeStatisticsNUTS(-89.53252571334252, 3, turning at positions -4:3, 0.9999999999999999, 7, DynamicHMC.Directions(0x3cbf7aab)), DynamicHMC.TreeStatisticsNUTS(-90.8296477564937, 3, turning at positions -5:2, 0.8785095280457346, 7, DynamicHMC.Directions(0x2bf1882a)), DynamicHMC.TreeStatisticsNUTS(-90.87142689251229, 3, turning at positions -1:6, 0.9436298117706834, 7, DynamicHMC.Directions(0x739878ce)), DynamicHMC.TreeStatisticsNUTS(-92.34192963219168, 3, turning at positions -3:4, 0.7069611152798981, 7, DynamicHMC.Directions(0x17565334)), DynamicHMC.TreeStatisticsNUTS(-87.99598679158304, 3, turning at positions -3:4, 0.9999999999999999, 7, DynamicHMC.Directions(0x1e631974)), DynamicHMC.TreeStatisticsNUTS(-88.79504700350212, 3, turning at positions -3:4, 0.9185328549469981, 7, DynamicHMC.Directions(0x7392f134)), DynamicHMC.TreeStatisticsNUTS(-87.99595651407306, 3, turning at positions -1:6, 0.9999999999999999, 7, DynamicHMC.Directions(0x001611ee))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.05556744795318417, 0.05767167901967418, 0.05992266100036058, 0.07375424906740949], ϵ = 0.7473332846026877)
 (posterior_matrix = [1.1448626241141497 1.0592434887709272 … 1.0345342024459032 1.0559382810813673; 2.013324959911177 1.9971390066985595 … 2.070962103598866 2.047144418490066; -1.0949425096873857 -0.9878615708420407 … -1.0374878940265735 -0.9843849692724529; -0.5984164631166734 -0.5809761732995317 … -0.5716123950453875 -0.7486086335900305], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-88.84363275832665, 2, turning at positions -1:2, 0.9066353999794062, 3, DynamicHMC.Directions(0x863d07d6)), DynamicHMC.TreeStatisticsNUTS(-89.66071363349201, 2, turning at positions -4:-7, 0.9829451517794912, 7, DynamicHMC.Directions(0xd79c3680)), DynamicHMC.TreeStatisticsNUTS(-87.13495554385435, 2, turning at positions 2:5, 0.9986301106432608, 7, DynamicHMC.Directions(0x1d47b80d)), DynamicHMC.TreeStatisticsNUTS(-90.04658316449641, 2, turning at positions 2:5, 0.8932702628213746, 7, DynamicHMC.Directions(0x2faf3265)), DynamicHMC.TreeStatisticsNUTS(-94.29989559738274, 3, turning at positions -6:1, 0.9707305424262564, 7, DynamicHMC.Directions(0x80fbd239)), DynamicHMC.TreeStatisticsNUTS(-90.22154766036192, 3, turning at positions -6:1, 0.9917251621112163, 7, DynamicHMC.Directions(0x766ce691)), DynamicHMC.TreeStatisticsNUTS(-91.12797468103388, 3, turning at positions 0:7, 0.97101845068727, 7, DynamicHMC.Directions(0x88407197)), DynamicHMC.TreeStatisticsNUTS(-91.99541316793812, 3, turning at positions -3:4, 0.9116858064742956, 7, DynamicHMC.Directions(0xadfce85c)), DynamicHMC.TreeStatisticsNUTS(-91.47701270899636, 3, turning at positions -6:1, 0.9708572066110425, 7, DynamicHMC.Directions(0x61186181)), DynamicHMC.TreeStatisticsNUTS(-88.60905671623746, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0xbde6d39d))  …  DynamicHMC.TreeStatisticsNUTS(-89.51542269764263, 3, turning at positions -7:0, 0.9267016366031754, 7, DynamicHMC.Directions(0xcccf2000)), DynamicHMC.TreeStatisticsNUTS(-88.50808239724802, 2, turning at positions -4:-7, 0.9995111036921419, 7, DynamicHMC.Directions(0x041f1e88)), DynamicHMC.TreeStatisticsNUTS(-88.05613118873032, 2, turning at positions 0:3, 0.8487299705665073, 3, DynamicHMC.Directions(0xd062f7f3)), DynamicHMC.TreeStatisticsNUTS(-88.30328371796516, 3, turning at positions -3:4, 0.9985623929112197, 7, DynamicHMC.Directions(0xc63acd64)), DynamicHMC.TreeStatisticsNUTS(-90.26147587124672, 2, turning at positions -2:1, 0.899481315613056, 3, DynamicHMC.Directions(0xe5214f55)), DynamicHMC.TreeStatisticsNUTS(-94.13426159978653, 2, turning at positions -1:-4, 0.887137168860854, 7, DynamicHMC.Directions(0xddf626cb)), DynamicHMC.TreeStatisticsNUTS(-89.5494448626992, 3, turning at positions -2:5, 0.9912656764344779, 7, DynamicHMC.Directions(0x1ea33cd5)), DynamicHMC.TreeStatisticsNUTS(-91.24262726398057, 3, turning at positions 0:7, 0.9137080642986246, 7, DynamicHMC.Directions(0x7789d39f)), DynamicHMC.TreeStatisticsNUTS(-87.94564249004287, 3, turning at positions -4:3, 0.9999999999999999, 7, DynamicHMC.Directions(0x2b01e81b)), DynamicHMC.TreeStatisticsNUTS(-87.49851018005562, 3, turning at positions -7:0, 0.984047021882138, 7, DynamicHMC.Directions(0xb5e93d00))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.048835601487793666, 0.05748031781045016, 0.057468752663056365, 0.07363512162297328], ϵ = 0.6368704449183767)
 (posterior_matrix = [1.0223402881108263 1.0418242389323416 … 1.0637300906270575 1.0451272115760455; 2.0480070573376774 2.002941953740189 … 2.04743254914175 2.0751460797704957; -1.007546871749349 -1.0162869658959741 … -0.977316707591255 -1.0703591342813605; -0.735259974787324 -0.8197836450784894 … -0.657993205810961 -0.6753274896300646], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-85.55354073387892, 3, turning at positions -4:3, 0.9997985733578382, 7, DynamicHMC.Directions(0x2f203f73)), DynamicHMC.TreeStatisticsNUTS(-88.3638891044878, 2, turning at positions -1:2, 0.7540306640240778, 3, DynamicHMC.Directions(0x273eceaa)), DynamicHMC.TreeStatisticsNUTS(-89.21427005729342, 2, turning at positions 3:6, 0.9614954277285015, 7, DynamicHMC.Directions(0xf7b36a8e)), DynamicHMC.TreeStatisticsNUTS(-86.94826036520405, 3, turning at positions -7:0, 0.9989424094430286, 7, DynamicHMC.Directions(0x56ddea08)), DynamicHMC.TreeStatisticsNUTS(-86.71247011296266, 3, turning at positions -7:0, 0.9898534340637016, 7, DynamicHMC.Directions(0x77f41ab0)), DynamicHMC.TreeStatisticsNUTS(-86.29039371632885, 3, turning at positions 0:7, 0.9902573954325311, 7, DynamicHMC.Directions(0x3c11a64f)), DynamicHMC.TreeStatisticsNUTS(-87.23797580356961, 3, turning at positions -6:1, 0.9076639787400179, 7, DynamicHMC.Directions(0xe6aec8d9)), DynamicHMC.TreeStatisticsNUTS(-90.66260568284977, 2, turning at positions 0:3, 0.8245072383583164, 3, DynamicHMC.Directions(0x42488bcb)), DynamicHMC.TreeStatisticsNUTS(-88.57924982226645, 2, turning at positions -1:2, 0.9187870691061049, 3, DynamicHMC.Directions(0x1d95435e)), DynamicHMC.TreeStatisticsNUTS(-86.91215998473345, 3, turning at positions -5:2, 0.9005250669327548, 7, DynamicHMC.Directions(0x2a6b2672))  …  DynamicHMC.TreeStatisticsNUTS(-89.72858023478518, 3, turning at positions -6:1, 0.9222709422140437, 7, DynamicHMC.Directions(0x92395139)), DynamicHMC.TreeStatisticsNUTS(-89.04285026346425, 2, turning at positions -2:1, 0.9372039228962111, 3, DynamicHMC.Directions(0x6f7d1ef1)), DynamicHMC.TreeStatisticsNUTS(-87.59374229153926, 3, turning at positions -5:2, 0.9999999999999999, 7, DynamicHMC.Directions(0x94f09b82)), DynamicHMC.TreeStatisticsNUTS(-87.01327288885572, 2, turning at positions -2:-5, 0.9963459969424242, 7, DynamicHMC.Directions(0x94e29aba)), DynamicHMC.TreeStatisticsNUTS(-86.08366848967434, 3, turning at positions -7:0, 0.9999999999999999, 7, DynamicHMC.Directions(0x84d11f18)), DynamicHMC.TreeStatisticsNUTS(-88.58406913122873, 2, turning at positions -3:0, 0.8417837646314089, 3, DynamicHMC.Directions(0xe173b31c)), DynamicHMC.TreeStatisticsNUTS(-88.60413406610678, 2, turning at positions -3:0, 0.9999999999999999, 3, DynamicHMC.Directions(0xcd058310)), DynamicHMC.TreeStatisticsNUTS(-88.54461186896353, 3, turning at positions -5:2, 0.9003221644870989, 7, DynamicHMC.Directions(0x311c3cba)), DynamicHMC.TreeStatisticsNUTS(-86.82079875718082, 2, turning at positions 0:3, 0.9999999999999999, 3, DynamicHMC.Directions(0x10ea94ab)), DynamicHMC.TreeStatisticsNUTS(-87.28443589695213, 3, turning at positions -2:5, 0.8779963211675821, 7, DynamicHMC.Directions(0xb6ba8f05))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.051291570019825206, 0.05342924106592147, 0.05666780400607684, 0.0729994263610528], ϵ = 0.7100391542518315)
 (posterior_matrix = [1.0836489681000836 1.0251955087324474 … 1.0013687961309554 1.052567455490058; 2.1328783310179724 1.9903071937472814 … 2.0645292375700484 2.10491358927375; -1.0554222894043146 -0.9736263299146457 … -1.033489759705611 -1.0118916445155568; -0.6988771366578289 -0.6385399787291354 … -0.5747014178701437 -0.7495687312051762], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-89.3839010524171, 3, turning at positions -3:4, 0.9918121269741613, 7, DynamicHMC.Directions(0xafc26eec)), DynamicHMC.TreeStatisticsNUTS(-87.05090343412927, 3, turning at positions -7:0, 0.9954521503750463, 7, DynamicHMC.Directions(0x1adbc368)), DynamicHMC.TreeStatisticsNUTS(-90.56334462862436, 3, turning at positions -2:5, 0.8263998972268892, 7, DynamicHMC.Directions(0xf1a9caf5)), DynamicHMC.TreeStatisticsNUTS(-90.3613890254311, 3, turning at positions -6:1, 0.9369313177640227, 7, DynamicHMC.Directions(0x3e011cc1)), DynamicHMC.TreeStatisticsNUTS(-88.74379836134841, 2, turning at positions -3:0, 0.9815986447576326, 3, DynamicHMC.Directions(0x4cf1a010)), DynamicHMC.TreeStatisticsNUTS(-88.23893560332225, 3, turning at positions -6:1, 0.9428233798138599, 7, DynamicHMC.Directions(0x07345c31)), DynamicHMC.TreeStatisticsNUTS(-88.53148060454278, 2, turning at positions -3:0, 0.9719790769972471, 3, DynamicHMC.Directions(0xdc1f9edc)), DynamicHMC.TreeStatisticsNUTS(-89.68848794804565, 3, turning at positions -5:2, 0.8629598497987364, 7, DynamicHMC.Directions(0x6d79591a)), DynamicHMC.TreeStatisticsNUTS(-86.61254202275275, 2, turning at positions -2:1, 0.9587700202204487, 3, DynamicHMC.Directions(0xdef6ba55)), DynamicHMC.TreeStatisticsNUTS(-87.9339088371523, 3, turning at positions -3:4, 0.9695123600435727, 7, DynamicHMC.Directions(0xf68e9494))  …  DynamicHMC.TreeStatisticsNUTS(-88.66767812066846, 3, turning at positions -5:2, 0.9933295203869841, 7, DynamicHMC.Directions(0x32698ff2)), DynamicHMC.TreeStatisticsNUTS(-90.50001798507176, 3, turning at positions 0:7, 0.962314309780299, 7, DynamicHMC.Directions(0xb6554577)), DynamicHMC.TreeStatisticsNUTS(-88.7627048966373, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0xf0438115)), DynamicHMC.TreeStatisticsNUTS(-87.26677058401567, 3, turning at positions 0:7, 0.975087812535943, 7, DynamicHMC.Directions(0x52608107)), DynamicHMC.TreeStatisticsNUTS(-87.63292280139798, 3, turning at positions -6:1, 0.989547642160977, 7, DynamicHMC.Directions(0xb82c8379)), DynamicHMC.TreeStatisticsNUTS(-86.17085066381416, 2, turning at positions -1:2, 0.9983517932579385, 3, DynamicHMC.Directions(0xa2f5ed96)), DynamicHMC.TreeStatisticsNUTS(-85.87248925333115, 3, turning at positions -5:2, 0.9677150446795141, 7, DynamicHMC.Directions(0x547f9392)), DynamicHMC.TreeStatisticsNUTS(-85.75162270029136, 2, turning at positions -2:-5, 0.9761833981468107, 7, DynamicHMC.Directions(0x9f9e41ba)), DynamicHMC.TreeStatisticsNUTS(-86.52971166568942, 2, turning at positions 0:3, 0.9190507155920514, 3, DynamicHMC.Directions(0x786e0b1f)), DynamicHMC.TreeStatisticsNUTS(-87.49617084751372, 3, turning at positions -1:6, 0.9768854636927776, 7, DynamicHMC.Directions(0x4e52c3e6))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.05032927910701873, 0.05622266504242715, 0.054756239770445386, 0.0723973100875639], ϵ = 0.6762870349659712)
 (posterior_matrix = [0.9574424652531068 1.048624889543274 … 0.9969214817298646 1.1230416849795744; 2.0704510906936995 2.034872423731086 … 2.0759574543677526 2.041260368408633; -1.1081200428119913 -1.0189519960983189 … -1.0788610853630405 -0.9452388445549285; -0.7208999460999346 -0.7007883072708864 … -0.736298905275316 -0.5927953124282567], tree_statistics = [DynamicHMC.TreeStatisticsNUTS(-89.69123592928044, 2, turning at positions -2:1, 0.7350039961008266, 3, DynamicHMC.Directions(0x8fcbbf85)), DynamicHMC.TreeStatisticsNUTS(-87.90228861018436, 3, turning at positions -3:4, 0.9999999999999999, 7, DynamicHMC.Directions(0x0d04cb24)), DynamicHMC.TreeStatisticsNUTS(-89.31007078826273, 1, turning at positions -1:-2, 0.6042899107804697, 3, DynamicHMC.Directions(0xb77b38d5)), DynamicHMC.TreeStatisticsNUTS(-87.02174550398145, 2, turning at positions -2:1, 0.9999999999999999, 3, DynamicHMC.Directions(0x08297f29)), DynamicHMC.TreeStatisticsNUTS(-86.24349162062022, 3, turning at positions -1:6, 0.9989618711531753, 7, DynamicHMC.Directions(0xd166b8b6)), DynamicHMC.TreeStatisticsNUTS(-88.52113118253708, 3, turning at positions -2:5, 0.7171588819667739, 7, DynamicHMC.Directions(0xbd732abd)), DynamicHMC.TreeStatisticsNUTS(-93.20134211094512, 2, turning at positions -1:2, 0.4419197091598884, 3, DynamicHMC.Directions(0x5d02ed16)), DynamicHMC.TreeStatisticsNUTS(-90.46645018656356, 2, turning at positions -1:2, 0.9909820126440483, 3, DynamicHMC.Directions(0xca5b4e0e)), DynamicHMC.TreeStatisticsNUTS(-90.40851328684674, 2, turning at positions 0:3, 0.8632346977702853, 3, DynamicHMC.Directions(0x29761b13)), DynamicHMC.TreeStatisticsNUTS(-86.90915886625015, 2, turning at positions -1:2, 0.9427147394687801, 3, DynamicHMC.Directions(0xe100a582))  …  DynamicHMC.TreeStatisticsNUTS(-87.62929540227685, 2, turning at positions -2:1, 0.8532650729961686, 3, DynamicHMC.Directions(0x62902ce9)), DynamicHMC.TreeStatisticsNUTS(-89.52860274225037, 2, turning at positions -2:-5, 0.7684458712702379, 7, DynamicHMC.Directions(0x26a2c912)), DynamicHMC.TreeStatisticsNUTS(-87.68590996573388, 2, turning at positions -2:1, 0.7794718796577104, 3, DynamicHMC.Directions(0x989c420d)), DynamicHMC.TreeStatisticsNUTS(-85.74090862091118, 2, turning at positions -2:1, 0.9770657037368977, 3, DynamicHMC.Directions(0xba69a8c5)), DynamicHMC.TreeStatisticsNUTS(-88.0746178655362, 2, turning at positions 0:3, 0.8493120306347633, 3, DynamicHMC.Directions(0xd5be41f3)), DynamicHMC.TreeStatisticsNUTS(-86.70905193415852, 2, turning at positions 0:3, 0.9933393983739163, 3, DynamicHMC.Directions(0xb0b3b097)), DynamicHMC.TreeStatisticsNUTS(-87.55218996259246, 2, turning at positions -3:0, 0.8518273406496509, 3, DynamicHMC.Directions(0xc732e428)), DynamicHMC.TreeStatisticsNUTS(-86.29829840083507, 3, turning at positions -2:5, 0.9910835621859123, 7, DynamicHMC.Directions(0x8b414685)), DynamicHMC.TreeStatisticsNUTS(-87.97069611598889, 2, turning at positions 0:3, 0.895619015081314, 3, DynamicHMC.Directions(0xbb1e272b)), DynamicHMC.TreeStatisticsNUTS(-88.75427638288014, 3, turning at positions -6:1, 0.893993108047739, 7, DynamicHMC.Directions(0xb9ae5ea9))], κ = Gaussian kinetic energy (Diagonal), √diag(M⁻¹): [0.054073584364107564, 0.055257804088311956, 0.055076542219602155, 0.07031672710431784], ϵ = 0.7965892291178904)</code></pre><p>We use the transformation to obtain the posterior from the chain.</p><pre><code class="language-julia hljs">posterior = transform.(t, eachcol(pool_posterior_matrices(results)));</code></pre><p>Extract the parameter posterior means: <code>β</code>,</p><pre><code class="language-julia hljs">posterior_β = mean(first, posterior)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Float64}:
  1.0461584162648956
  2.0631145061435223
 -1.0173888760058394</code></pre><p>then <code>σ</code>:</p><pre><code class="language-julia hljs">posterior_σ = mean(last, posterior)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.5148695423657319</code></pre><p>Effective sample sizes (of untransformed draws)</p><pre><code class="language-julia hljs">ess, R̂ = ess_rhat(stack_posterior_matrices(results))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(ess = [5635.175098477229, 5608.861762517669, 5401.689141192709, 4870.19780093924], rhat = [1.0000112837101467, 1.0001954274270717, 1.000248225248275, 1.000097670258322])</code></pre><p>summarize NUTS-specific statistics of all chains</p><pre><code class="language-julia hljs">summarize_tree_statistics(mapreduce(x -&gt; x.tree_statistics, vcat, results))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Hamiltonian Monte Carlo sample of length 5000
  acceptance rate mean: 0.92, 5/25/50/75/95%: 0.72 0.88 0.95 0.99 1.0
  termination: divergence =&gt; 0%, max_depth =&gt; 0%, turning =&gt; 100%
  depth: 0 =&gt; 0%, 1 =&gt; 1%, 2 =&gt; 47%, 3 =&gt; 51%</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example_independent_bernoulli/">« Estimate Bernoulli draws probabilility</a><a class="docs-footer-nextpage" href="../example_logistic_regression/">Logistic regression »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 28 February 2023 15:44">Tuesday 28 February 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
